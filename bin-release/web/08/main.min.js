var utills;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("startbg_png"),this.bg.width=this.stage.stageWidth,this.bg.height=this.stage.stageHeight,this.bg.x=0,this.bg.y=0,this.addChild(this.bg)},s.changeBg=function(){this.bg.texture=RES.getRes("bg_jpg")},e}(egret.Sprite);t.Bg=e,egret.registerClass(e,"utills.Bg")}(utills||(utills={}));var CLoadStar=function(t){function e(){t.call(this),this.starTex=[],this.star_index=0,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/load.config.json","resource/")}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preloadsload")},s.onResourceLoadComplete=function(t){"preloadsload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createView())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.createView=function(){for(var t=0;19>t;++t){var e="loadstar_json.ls"+t.toString();this.starTex.push(RES.getRes(e))}this.star=new egret.Bitmap(this.starTex[0]),this.addChild(this.star),this.star.anchorOffsetX=this.star.width/2,this.star.anchorOffsetY=this.star.height/2,this.star.x=g_nStageW/2,this.star.y=g_nStageH/2,egret.startTick(this.starRun,this)},s.starRun=function(){return this.star.texture=this.starTex[this.star_index++],this.star_index>18&&(this.star_index=0),!0},s.setProgress=function(t,e){t==e&&egret.stopTick(this.starRun,this)},e}(egret.Sprite);egret.registerClass(CLoadStar,"CLoadStar");var g_nStageW,g_nStageH,config=config,Main=function(t){function e(){t.call(this),this.musicStatus=!0,this.millisecond=0,this.second=config.times,this.successIndex=0,this.offsetWidth=0,this.offsetHeight=0,this.tempSite={x:1,y:0,x_place:0,y_place:0},this.tempTargetSite={x:1,y:0,x_place:0,y_place:0},this.imageShow=[],this.placeSite=[],this.newInageShow=[],this.boxMask=new egret.Shape,this.successTimer=new egret.Timer(1e3,1),this.grade=1,this.sumGrade=config.sumGrade,this.gamePanel=new egret.Sprite,this.listArea=[],this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){g_nStageW=this.stage.stageWidth,g_nStageH=this.stage.stageHeight,this.loadingView=new CLoadStar,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(config.resourceUrl+"default.res.json",config.resourceUrl)},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.gameGg=new utills.Bg,this.addChild(this.gameGg),this.musicBtn=new utills.Music,this.musicBtn.x=40,this.musicBtn.y=40,this.musicBtn.touchEnabled=!0,this.musicBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeMusic,this),this.addChild(this.musicBtn),this.timerText=new egret.TextField,this.startGame()},s.startGame=function(){this.gameGg.changeBg(),this.Timer=new egret.Timer(1e3/60,6e3),this.Timer.addEventListener(egret.TimerEvent.TIMER,this.countTimer,this),this.Timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerEnd,this),this.Timer.start(),this.timerText.text=this.second+":"+this.millisecond,this.timerText.textColor=16777215,this.timerText.fontFamily="微软雅黑",this.timerText.size=30,this.timerText.x=this.stageW/2-this.timerText.width/2+10,this.timerText.y=.12*this.stageH,this.addChild(this.timerText),this.init(),this.offsetWidth=(this.stage.stageWidth-this.animalBox.width)/2,this.boxMask.width=this.stage.stageWidth,this.successTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.isSuccess,this)},s.changeMusic=function(){this.musicStatus?(this.musicBtn.stop(),this.musicStatus=!1):(this.musicBtn.play(),this.musicStatus=!0)},s.countTimer=function(){this.millisecond--,this.millisecond<0&&(this.second--,this.millisecond=59),this.timerText.text=this.second+":"+this.millisecond},s.timerEnd=function(){this.status="failure",this.grade=1,this.removeChild(this.smallPic),this.animalBox.removeChildren(),this.imageShow=[],this.placeSite=[],this.newInageShow=[],this.successIndex=0,this.gameOver()},s.gameOver=function(){this.animalBox.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this);var t=100-this.second,e=this.second+20;switch(e>100&&(e=100),this.status){case"succ":var i="suc_png",s="您花了"+t+"秒，完成拼图击败了全国"+e+"%的人";break;case"failure":var i="not_png",s="未能在100秒内完成所有拼图完,成所有拼图即可参与抽奖"}this.gameOverPic||(this.gameOverPic=new egret.Bitmap,this.gameOverPic.texture=RES.getRes(i),this.gameOverPic.width=.7*this.stage.stageWidth,this.gameOverPic.height=.7*this.gameOverPic.height,this.gameOverPic.x=this.stage.stageWidth/2-this.gameOverPic.width/2,this.gameOverPic.y=200,this.addChild(this.gameOverPic)),this.gameOverPic.texture=RES.getRes(i),this.contentText||(this.contentText=new egret.TextField,this.contentText.width=.7*this.stageW,this.contentText.height=100,this.contentText.lineSpacing=1.5,this.contentText.textAlign=egret.HorizontalAlign.CENTER,this.contentText.size=22,this.contentText.y=this.gameOverPic.y+20+this.gameOverPic.height,this.contentText.x=this.stage.stageWidth/2-this.contentText.width/2,this.addChild(this.contentText)),this.contentText.text=s,null!=this.animalBox.parent&&this.animalBox.parent.removeChild(this.animalBox),null!=this.smallPic.parent&&this.removeChild(this.smallPic);var h=this;setTimeout(function(){h.skipGift()},2e3)},s.skipGift=function(){var t=this.grade,e=document.createElement("form"),i=document.createElement("input");e.action=config.submitUrl,e.method="POST",i.type="hidden",i.name="score",i.value=""+t,e.appendChild(i),document.body.appendChild(e),e.submit()},s.init=function(){var t=this.grade;switch(t){case 1:this.splitRow=2,this.animalName="animal"+t+"_jpg";break;case 2:this.splitRow=3,this.animalName="animal"+t+"_jpg";break;case 3:this.splitRow=3,this.animalName="animal"+t+"_jpg";break;case 4:this.splitRow=4,this.animalName="animal"+t+"_jpg";break;case 5:this.splitRow=5,this.animalName="animal"+t+"_jpg"}this.smallPic=new egret.Bitmap,this.smallPic.texture=RES.getRes(this.animalName),this.smallPic.width=.3*this.smallPic.width,this.smallPic.height=.3*this.smallPic.height,this.smallPic.x=20,this.smallPic.y=this.stageH-this.smallPic.height-20,this.addChild(this.smallPic),this.animalBox=new egret.Sprite,this.thumbnail=new egret.Bitmap,this.thumbnail.texture=RES.getRes(this.animalName),this.thumbnail.width=500;var e=this.thumbnail.width/this.splitRow*.7,i=Math.floor(this.thumbnail.width/this.splitRow);this.animalBox.graphics.beginFill(16763347,1),this.animalBox.graphics.drawRect(e*s,h*e,.7*this.thumbnail.width,.7*this.thumbnail.width),this.animalBox.graphics.endFill(),this.animalBox.x=this.stageW/2-this.animalBox.width/2,this.animalBox.y=.18*this.stageH,this.boxMask=new egret.Shape,this.boxMask.graphics.beginFill(16763347),this.boxMask.graphics.drawRect(e*s,h*e,.7*this.thumbnail.width,.7*this.thumbnail.width),this.boxMask.graphics.endFill(),this.boxMask.x=this.stageW/2-this.animalBox.width/2,this.boxMask.y=.18*this.stageH,this.animalBox.mask=this.boxMask,this.addChild(this.boxMask);for(var s=0;s<this.splitRow;s++)for(var h=0;h<this.splitRow;h++){var n=new egret.Rectangle(i*s,h*i,i,i),a=new egret.RenderTexture,r=new utills.animalBody;a.drawToTexture(this.thumbnail,n),r.texture=a;var o=6,l=3;r.height=(this.animalBox.width-2*o-l*(this.splitRow-1))/this.splitRow,r.width=(this.animalBox.width-2*o-l*(this.splitRow-1))/this.splitRow;var g=r.width;0==s&&0==h?this.placeSite.push({x:r.x=r.x_place=g*s+o,y:r.y=r.y_place=g*h+o}):this.placeSite.push({x:r.x=r.x_place=g*s+l*s+o,y:r.y=r.y_place=g*h+l*h+o}),this.animalBox.addChild(r),this.imageShow.push(r)}this.changeOrder()},s.changeOrder=function(){for(var t=[],e=0,i=this.imageShow.length;i>e;e++)t[e]=this.imageShow[e];for(var e=0,i=t.length;i>e;e++)this.newInageShow[e]=t.splice(Math.ceil(Math.random()*t.length)-1,1)[0];for(var s=0,i=this.placeSite.length;i>s;s++)this.animalBox.addChild(this.newInageShow[s]),this.newInageShow[s].x=this.placeSite[s].x,this.newInageShow[s].y=this.placeSite[s].y,this.newInageShow[s].touchEnabled=!0,this.newInageShow[s].addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.isMatchPlace(this.newInageShow[s])&&this.successIndex++;this.addChild(this.animalBox)},s.isMatchPlace=function(t){return t.x==t.x_place&&t.y==t.y_place?!0:!1},s.touchStart=function(t){if(e.touchStatus){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),t.target.parent.setChildIndex(t.target,-1),this.tempSite={x:t.target.x,y:t.target.y,x_place:t.target.x_place,y_place:t.target.y_place},this.tempImage=t.target,this.tempImage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this);for(var i=0;i<this.newInageShow.length;i++)this.newInageShow[i]!=t.target&&(this.newInageShow[i].touchEnabled=!1);this.moveX=t.stageX,this.moveY=t.stageY,this.animalBox.touchEnabled=!0,this.animalBox.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)}},s.touchMove=function(t){var e=t.stageX-this.moveX,i=t.stageY-this.moveY;this.tempImage.x=this.tempImage.x+e,this.tempImage.y=this.tempImage.y+i,this.moveX=t.stageX,this.moveY=t.stageY;var s=this.animalBox.width,h=this.animalBox.height;(t.stageY<=.18*this.stageH||t.stageY>=.18*this.stageH+h||t.stageX<this.offsetWidth||t.stageX>s+this.offsetWidth)&&(this.tempImage.x=this.tempSite.x,this.tempImage.y=this.tempSite.y)},s.touchEnd=function(t){for(var e=0;e<this.newInageShow.length;e++)this.newInageShow[e].touchEnabled=!0;this.swapBody(this.tempImage),this.animalBox.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this)},s.swapBody=function(t){for(var i=0;i<this.newInageShow.length;i++){var s=this.newInageShow[i];s!=t&&s.x<t.x+t.width/1.2&&s.x>t.x-t.width/1.2&&s.y<t.y+t.height/1.2&&s.y>t.y-t.height/1.2&&this.listArea.push(s)}if(this.listArea.length>0){var s=this.calculateArea(t);this.isMatchPlace(this.tempSite)&&this.successIndex--,this.isMatchPlace(s)&&this.successIndex--;var h=s.x,n=s.y,a=this.tempSite.x,r=this.tempSite.y;return this.tempTargetSite={x:this.tempSite.x,y:this.tempSite.y,x_place:s.x_place,y_place:s.y_place},egret.Tween.get(s).to({x:a,y:r},200).call(function(){e.touchStatus=!0}),egret.Tween.get(t).to({x:h,y:n},200).call(function(){e.touchStatus=!0}),this.tempSite.x=h,this.tempSite.y=n,this.isMatchPlace(this.tempSite)&&this.successIndex++,this.isMatchPlace(this.tempTargetSite)&&this.successIndex++,this.successTimer.start(),e.touchStatus=!1,void this.tempImage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this)}(t.x<0||t.x>this.animalBox.width||t.y<0||t.y>this.animalBox.height)&&(t.x=this.tempSite.x,t.y=this.tempSite.y),this.tempImage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),t.x=this.tempSite.x,t.y=this.tempSite.y},s.calculateArea=function(t){for(var e,i,s,h,n=0,a=0,r=0;r<this.listArea.length;r++)e=this.listArea[r],h=t.width-Math.abs(e.x-t.x),s=t.height-Math.abs(e.y-t.y),n=s*h,n>a&&(a=n,i=e);return this.listArea=[],i},s.isSuccess=function(){if(this.successIndex==Math.pow(this.splitRow,2)){if(this.animalBox.removeChildren(),this.removeChild(this.smallPic),this.imageShow=[],this.placeSite=[],this.newInageShow=[],this.successIndex=0,this.animalBox.parent&&this.removeChild(this.animalBox),this.grade>=this.sumGrade)return this.Timer.stop(),this.status="succ",void this.gameOver();this.grade++,this.init()}},s.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},s.startAnimation=function(t){for(var e=this,i=new egret.HtmlTextParser,s=[],h=0;h<t.length;h++)s.push(i.parser(t[h]));var n=e.textfield,a=-1,r=function(){a++,a>=s.length&&(a=0);var t=s[a];e.changeDescription(n,t);var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,e)};r()},s.changeDescription=function(t,e){t.textFlow=e},e.touchStatus=!0,e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var utills;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.banner=new egret.Bitmap,this.banner.texture=RES.getRes("banner_png"),this.banner.height=80,this.banner.width=640,this.addChild(this.banner)},e}(egret.Sprite);t.AdBanner=e,egret.registerClass(e,"utills.AdBanner")}(utills||(utills={}));var utills;!function(t){var e=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Bitmap);t.animalBody=e,egret.registerClass(e,"utills.animalBody")}(utills||(utills={}));var utills;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.gift=new egret.Bitmap,this.gift.texture=RES.getRes("giftbtn_png"),this.gift.width=.5*this.gift.width,this.gift.height=.5*this.gift.height,this.gift.anchorOffsetX=this.gift.width/2,this.gift.anchorOffsetY=this.gift.height/2,this.addChild(this.gift)},e}(egret.Sprite);t.gift=e,egret.registerClass(e,"utills.gift")}(utills||(utills={}));var utills;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.button=new egret.Bitmap,this.button.texture=RES.getRes("musicbtn_png"),this.button.width=.5*this.button.width,this.button.height=.5*this.button.height,this.button.anchorOffsetX=this.button.width/2,this.button.anchorOffsetY=this.button.height/2,this.addChild(this.button),this.sound=new egret.Sound,this.sound.addEventListener(egret.Event.COMPLETE,function(t){this.play()},this),this.buttonSpin=egret.Tween.get(this.button,{loop:!0}),this.buttonSpin.to({rotation:360},3500),this.sound.load("resource/sound/pintu.mp3")},s.play=function(){this.SoundChannel=this.sound.play(0,0),this.buttonSpin.setPaused(!1)},s.stop=function(){this.SoundChannel.stop(),this.buttonSpin.setPaused(!0)},e}(egret.Sprite);t.Music=e,egret.registerClass(e,"utills.Music")}(utills||(utills={}));var utills;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(){this.rule=new egret.Bitmap,this.rule.texture=RES.getRes("rulebtn_png"),this.rule.width=.5*this.rule.width,this.rule.height=.5*this.rule.height,this.rule.anchorOffsetX=this.rule.width/2,this.rule.anchorOffsetY=this.rule.height/2,this.addChild(this.rule)},e}(egret.Sprite);t.Rulls=e,egret.registerClass(e,"utills.Rulls")}(utills||(utills={}));